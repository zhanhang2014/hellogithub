---
layout:     post
title:      "使用AWS搭建自己的VPN"
subtitle:   "论如何造一把称手的梯子"
date:       2016-06-10 12:00:00
author:     "Hang"
header-img: "img//2016-06-03/head-bg.jpg"
catalog: true
tags:
    - 技术
---

## 前言

这一篇博客记录关于自己搭建VPN的内容。**但是**，我并不想写太多细节方面的东西，[后文](#build)列出了很详细的教程，之前我自己也是照着这些教程来做的。

我想就写一写照着教程，踩着一些坑，最后好歹成功搭建起VPN这个过程，自己逐渐形成的“哦，这个原来大概就是这么个玩意儿”一般的认识。


## 原理

简单来说，我们之所以需要使用 VPN ，是因为我们需要加密数据来避免GFW的封锁。

#### GFW 简单说明

GFW 的封锁主要包括：

1. 关键字过滤
2. IP封锁
3. DNS污染、劫持
4. 特定端口封锁
5. 加密连接干扰

而之所以其能够进行封锁，是因为网络协议的数据包头部是明文的，加密连接HTTPS的公钥也是明文的。如果在跨境传输过程中有某种加密手段，那么监视和封锁便无从谈起了。

#### VPN 简单说明

VPN(virtual private network) 能够将私有网络如局域网连接到公共网络或互联网上，用户可以通过连接到私有网络的设备访问公共网络或互联网[(wiki)](https://en.wikipedia.org/wiki/Virtual_private_network)。

![](/img/2016-06-10/vpn-mechanic.png)

也就是说, VPN 能够让你的设备远程连接到一台主机上，通过这台主机访问互联网，而你的设备和这台主机之间的数据传输是经过加密的。

## 实现

要实现 VPN 的搭建我们需要准备：

>一台不受封锁的服务器

>以及一种与这台服务器通信的、加密的数据传输协议

那么下文就再继续讲这两方面的内容。

#### 服务器
<p id = "build"></p>

服务器方面，推荐亚马逊的[AWS](https://aws.amazon.com/cn/), 新用户可以免费使用一年。

申请教程在[这里](http://bbs.ngacn.cc/read.php?tid=7298878)写得非常详细。

关于AWS有一些值得注意的地方：

1. 免费申请的服务器是有适用范围的，超出部分需要付费，务必谨慎操作；
2. 避免额外开销的TIPS:

	> 1. 在网上购买虚拟信用卡用于认证，这样即使产生了费用也不会扣到你的钱
	> 2. 注意同时只运行一个实例，保证时间不超过上限
	> 3. 不用的实例记得及时关闭，解除绑定的IP及时删除(我因为这个扣了几美分)
	> 4. 时常登录控制台查看自己的账单

3. 可以选择服务器实例区域，建议选东京，我现在用着很流畅，最开始选的美国延时很高

#### 协议

##### 隧道技术

隧道技术的基本过程是在源局域网与公网的接口处将数据(可以是ISO七层模型中的数据链路层或网络层数据)作为负载封装在一种可以在公网上传输的数据格式中，在目的局域网与公网的接口处将数据解封装，取出负载。被封装的数据包在互联网上传递时所经过的逻辑路径被称为“隧道”。

![](/img/2016-06-10/vpn-protocal.jpg)

目前VPN隧道协议主要有4种：点到点隧道协议PPTP、第二层隧道协议L2TP、网络层隧道协议IPSec以及SOCKS v5。各种协议的特点有兴趣可以自己了解一下。

比如，打开ios的新建 VPN 选项，可以看到这样的内容：

![](/img/2016-06-10/vpn-options.jpg)

其中这个 IKEv2 是一个新版的安全协议，应该是今后发展的趋势。我现在使用的是 PPTP 协议，[上面](#build)教程中也有详细介绍。PPTP协议比较简单，容易被识别，比如如果我使用校园网就连不上。感觉ios里 VPN 协议是按照推荐顺序排列的。最为稳定的应该是 IKEv2 吧。而且现在 Ubuntu 上能够直接使用 apt-get 安装了，后面我也可以考虑换成 IKEv2 吧。

最后再给两个教程：

[L2TP/IPSec VPN 架设教程](http://blog.csdn.net/simonjay2007/article/details/7563933)

[IPSec/IKEv2 VPN 架设教程](http://www.tuicool.com/articles/MjqE7fF)


## 后记

搭梯子教程到这里就结束了。

当然 AWS 的用处远不止搭建 VPN 这么一点儿。以后有时间再慢慢发掘吧。

对了我最喜欢在Ins上关注的插画家们，有空时刷一刷，很多作品都超级耐看。